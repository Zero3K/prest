<!DOCTYPE HTML>
<html>
<head>
<link rel=stylesheet href="../../../modules/coredoc/coredoc.css" />
<style>
pre { white-space: pre-wrap; }
.cmd:before { content: "$ "; }
</style>
<title>FFmpeg Media Backend Documentation</title>
</head>
<body>
<h1>FFmpeg Media Backend Documentation</h1>
<p>See also the main
<a href="../../../modules/media/documentation/index.html">media module
documentation</a>.</p>

<h2>Overview</h2>
<p>Opera now uses FFmpeg as its multimedia framework instead of GStreamer.
FFmpeg provides comprehensive codec support, excellent performance, and a
simpler API that's easier to integrate and maintain.</p>

<h2>Memory</h2>
<h3>OOM handling</h3>
<p>FFmpeg provides better control over memory allocation compared to GStreamer.
The FFmpeg media backend uses Opera's memory allocator and properly handles
OOM conditions by returning appropriate error codes rather than terminating
the application.</p>

<h3>Memory usage</h3>
<p>FFmpeg memory management is more predictable than GStreamer. The FFmpeg
backend manages memory explicitly and all resources are properly freed when
the MediaElement object is destroyed.</p>

<h4>Tuning</h4>
<p>The FFmpeg backend uses configurable buffer sizes and queue lengths
that can be tuned for optimal performance without the complex pipeline
management required by GStreamer.</p>

<h2>Thread safety</h2>
<p>The FFmpeg backend uses a simpler threading model compared to GStreamer.
Decoding happens in dedicated threads while maintaining proper synchronization
with Opera's main thread. This eliminates many of the thread safety issues
that were present with GStreamer.</p>

<h2>Building</h2>
<p>The FFmpeg backend uses dynamic library loading, so no special build
dependencies are required. FFmpeg libraries are loaded at runtime if available.
On most systems, FFmpeg can be installed via:</p>
<ul>
<li>Debian/Ubuntu: <code>libavcodec-dev libavformat-dev libavutil-dev</code></li>
<li>RHEL/CentOS: <code>ffmpeg-devel</code></li>
<li>macOS: <code>brew install ffmpeg</code></li>
<li>Windows: FFmpeg DLLs in the application directory</li>
</ul>

<h2>Debugging</h2>
<p>FFmpeg provides comprehensive logging capabilities. Set the following
environment variables for debugging:</p>
<ul>
<li><code>FFREPORT=file=ffmpeg.log:level=32</code> - Enable detailed logging</li>
<li><code>AV_LOG_FORCE_NOCOLOR=1</code> - Disable color output for easier parsing</li>
</ul>

<h3>Testing Media Files</h3>
<p>To test if a media file should work with Opera's FFmpeg backend:</p>
<pre class="cmd">ffmpeg -i example.mp4 -f null -</pre>
<p>If this command succeeds, the file should play in Opera.</p>

<h3>Codec Support</h3>
<p>The FFmpeg backend supports a wide range of codecs including:</p>
<ul>
<li>Video: H.264, H.265/HEVC, VP8, VP9, AV1</li>
<li>Audio: AAC, MP3, Vorbis, Opus, FLAC</li>
<li>Containers: MP4, WebM, MKV, AVI, MOV</li>
<li>Streaming: RTSP, RTMP, RTP, HLS, DASH</li>
</ul>

</body>
</html>
